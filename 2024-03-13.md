# 데이터베이스에서 exists()를 사용할 수 있을 땐 count()를 피해라

[Avoid Using COUNT() in SQL When You Could Use EXISTS()](https://blog.jooq.org/avoid-using-count-in-sql-when-you-could-use-exists/)

위 글에서는 exists()로 충분할 땐 count()를 피하라고 한다. 이유는 아래와 같다.   
exists() 쿼리를 데이터베이스에게 보내면, 데이터베이스는 존재하는지만 계산하면 된다. 즉 1행에서 바로 끝날 수도 있다.   
count()로 보내게 된다면 데이터베이스는 항상 모든 열을 확인하여 값을 반환해줄 것이다.(count()를 보낸다는 건 몇개나 존재하는지를 묻는 것)   
자바로 비유하자면 아래와 같다.   
```java
// exists()
if (collection.isEmpty()) {
    return false;
}
return true;

// count()
return collection.size();
```

`collection.isEmpty()` 내부적으로 `collection.size() == 0` 을 비교하여 자바에서는 다른 점이 없다.   
하지만 `size` 라는 값을 캐싱하고 있지 않다면 이야기는 달라진다. `collection.isEmpty()` 는 값이 없는지를 돌아볼테고, `collection.size()` 는 개수를 세어 반환해줄 것이다.   
SQL에서는 모든 요청을 미리 캐싱해둘 수 없으므로 캐싱하고 있지 않을 때처럼 작동한다.

## 결론

`exists()` 요청만으로 충분할 때는 `exsits()` 를 사용하고 절대 `count()` 를 사용하지 말자

## JPA에서는 어떻게 수행할까?

[JPA exists 쿼리 성능 개선](https://jojoldu.tistory.com/516)

`JpaRepository` 내부적으로 limit 1을 사용하여 `exists()` 와 동일한 성능 효과를 누린다.   
`exists()` 를 사용할 수 없는 경우 limit 1 을 사용하면 좋을 것 같다.

# 인터넷 동작 방식

[네트워크와 인터넷 개념 설명! 인터넷 동작 방식도 설명!](https://www.youtube.com/watch?v=oFKYzp6gGfc&t=717s)

위 영상은 큰 틀에서 인터넷이 어떻게 상호작용 하는지를 쉽게 설명해준다.   

## 요약

우리는 다른 컴퓨터와 연결하여 서로 정보를 교환한다. 어떻게 이것이 가능할까? 작은 단위(내부)에서부터 큰 단위로 설명해보겠습니다.   
집이라고 가정하고 컴퓨터와 프린트로부터 시작해보겠습니다. 프린트가 출력을 하기 위해서는 서로 네트워크로 연결되어 있어야 합니다.(네트워크: 디바이스들을 잇는 도로 시스템)   
컴퓨터와 프린트를 연결시켜주는 공유기(home router)를 통해 서로 연결된 상태로, 컴퓨터는 프린트에게 출력할 데이터와 출력 명령어를 내려주고, 프린트를 이를 받아 출력할 수 있습니다.   
이 때 내부망을 LAN(Local Arad Network)라고 부릅니다. LAN는 유선 통신인 Ethenet과 무선 통신인 wireless LAN(와이파이)가 있습니다.   
이제 외부로 나가보겠습니다. 유투브를 보기 위해서는 유투브 서버가 있는 곳까지 요청을 보내고, 응답을 받아 출력해야 합니다.   
먼저 외부망으로 나가기 위해서는 컴퓨터가 공유기로 신호를 보내고, 공유기는 모뎀(변조-복조기)을 통해 아날로그 신호로 변조하여 외부로 보냅니다.(공유기와 모뎀이 합쳐져 있는 것도 있음)   
모뎀은 외부 라우터로 요청을 보내면 외부 라우터들끼리 유투브 서버의 위치로 데이터를 배달시켜줍니다. (여러 LAN들이나 다른 네트워크를 하나로 묶어 멀리 떨어진 기기들이 통신 가능하도록 하는 네트워크를 WAN(Wide Area Network)라고 부릅니다.)   

LAN들을 묶어 WAN이라 하고, WAN들을 묶어 전세계에서 가장 큰 WAN들의 집합을 Internet이라고 부른다.(global network)

### 모뎀을 꽂으면 바로 연결되는가?

그렇지 않다. 외부 라우터를 이용하여 트래픽을 전송할라면 서비스를 이용해야 한다. 이 서비스를 ISP(Internet Service Provider)라 한다. 한국에서 ISP 서비스를 제공해주는 대표적인 기업들은 SK, LG, KT 등이 있다.   
ISP들은 자신만의 라우터를 보유하여 모뎀의 요청을 받아 다른 라우터를 통해 원하는 위치로 보낸다. ISP끼리도 요청과 응답을 받으니 트래픽이 발생하고 서로 요금을 지불한다.(하위 티어 ISP는 상위 티어 ISP를 이용하지만 상위 ISP는 서로 통신할 수 있다. 그래서 하위 ISP는 상위 ISP에게 요금을 지불하지만 상위 ISP는 상위 ISP끼리 합의하여 지불하지 않는 경우도 있다)   

### 용어 정리

**노드**: 지금까지 말한 모든 디바이스(컴퓨터, 프린트, 공유기, 모뎀, 외부 라우터 등)   
**end system, 호스트(host)**: 노드들 중에 끝단에 위치한 디바이스, 네트워크를 사용하기 위해 연결된 노드
**클라이언트(client)**: 다른 호스트로 요청을 보내는 호스트   
**서버(server)**: 다른 호스트에게 서비스를 제공하는 호스트   
