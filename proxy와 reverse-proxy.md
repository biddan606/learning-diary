# Proxy

`Proxy`는 말 그대로 '대리' 역할을 하는 중계 서버입니다.

![alt text](<image/proxy와 reverse-proxy.md/proxy.png>)

위 그림과 같이 클라이언트단에 위치합니다. 다음과 같은 목적으로 사용될 수 있습니다.
- **보안**: 클라이언트가 유해 콘텐츠를 다운받는 것을 보호합니다
  - 예, 회사에서 직원이 외부로부터 유해 콘텐츠를 받을 경우, 미리 검사하여 다운로드 받지 못하게 할 수 있습니다
- **로깅**: 모든 트래픽의 로그를 남길 수 있습니다.
  - 예, 회사에서 누가 언제 어떤 사이트에 접속하였는지 감사가 필요할 때를 대비하여 로깅해둘 수 있습니다
- **캐싱**: 자주 요청되는 데이터를 저장해두고 빠르게 응답하기 위해 사용할 수 있습니다.
  - 예, 회사 내의 사람들이 용량이 큰 파일이 필요할 경우, 매번 해당 데이터를 받아오는 것이 아니라 `proxy-server`에 저장해두고 요청시 저장된 데이터를 줄 수 있습니다.

# Reverse-proxy

`Proxy`의 한 종류로, 서버 측에 위치하여 클라이언트의 요청을 내부 서버에 전달하는 역할을 합니다.

![alt text](<image/proxy와 reverse-proxy.md/reverse-proxy.png>)

다이렉트로 서버에 연결하는 것이 아닌 `proxy`를 통하므로 유연성이 증가합니다.   
이 유연성을 확장, 공통 기능 처리를 할 수 있습니다.
- **SSL/TLS 처리**: SSL 인증서 관리 및 암복호화 연산을 `reverse-proxy`가 담당하여 각 서버에 인증서를 설치할 필요가 없습니다.
- **로드 밸런싱**: 들어오는 트래픽을 여러 서버에 분산시켜 각 서버의 부하를 줄여줍니다.(확장성)
- **보안**: 하나의 방화벽처럼 사용하여 인증, 악성 요청 필터링, 접근제어 등 보안 정책을 펼칠 수 있습니다.
- **캐싱**: 서버별로 중복 캐싱을 저장하는 것이 아니라 `proxy`에서 일괄 처리할 수 있습니다.(중복 최소화)


## 왜 Reverse지?

처음에는 용어의 기원에 관해 `reverse-proxy`가 "요청-응답 구조가 거꾸로 되어 있어서" 그렇게 이름 붙여졌을 것으로 추측하였습니다.
하지만 실제로는:
- `proxy`는 클라이언트 측에서 사용되는 것을 가리킴
- `reverse-proxy`는 서버 측에서 사용되는 것을 가리키며, 여기서 `reverse`는 "server의 뒷단"을 의미합니다.

이 정보를 블로그에서 얻으셨기 때문에 신빙성이 있진 않고, 이 글을 정리하는 지금 `reverse-proxy`라는 용어 자체가 애매모호하다고 생각하여 맘에 들지 않습니다!!!   
`proxy` <- 클라이언트 관심사, `reverse-proxy`는 서버의 관심사라고 생각하면 될 것 같습니다.

## Cloud Load Balancer가 있는데 Reverse-proxy가 필요할까?

제가 써본 로드밸런서는 AWS의 두가지 종류가 있습니다.
- **외부 로드밸런서(ALB)**: Public IP를 가지고 있어 인터넷에서 접근 가능
- **내부 로드밸런서**: Private IP만 할당되어 VPC 내부에서만 접근 가능, ECS에서 서비스 간 트래픽 분산에 주로 사용

Cloud Load Balancer가 기본적인 수준과 추가적인 기능을 제공해줍니다.
- **고급 라우팅**: 호스트 기반, 경로 기반, HTTP 헤더, 쿼리스트링, 소스 IP 등 다양한 조건으로 트래픽을 세분화해 라우팅 가능
- **세밀한 보안 정책**: 기본적인 보안 정책(차단, 허용, 제한 등)은 적용 가능
- **세밀한 요청/응답 로깅**: 요청 시각, 클라이언트 IP, 요청 경로, 응답 코드, 지연 시간 등 다양한 정보를 로그

캐싱 기능을 제공해주진 않지만, 그 외 다양한 기능들을 제공해줍니다. 웬만한 경우에는 Cloud Load Balancer로 대체가 가능합니다.
다만, 몇몇 경우 `reverse-proxy`가 필요할 수 있습니다.
- **동적 라우팅**: 정적인 부하분산이 아니라 서버 상태에 따른 동적인 라우팅이 필요한 경우
- **캐싱**: 자주 요청되는 정적/동적 리소스를 자체적으로 캐싱해야 하는 경우
- **데이터 수정**: 서버에 요구사항과 프론트 요구사항이 달라 데이터 형식을 수정해야 사용해야 할 수 있습니다. 이 떄 `reverse-proxy`로 변환하여 서버에 요청
- **세밀한 요청/응답 로깅 및 트래픽 모니터링**: `Cloud Load Balancer`가 제공하는 로깅 이상의 분석이 필요한 경우

`Cloud Load Balancer`와 `Reverse-proxy`가 상호 베타적이라고 생각하진 않습니다. 다만 `Cloud Load Balancer`가 일반적으로 필요한 기능들을 제공해주고, 그 이상이 필요한 경우 `Reverse-proxy`를 배치하면 될 것 같습니다.
